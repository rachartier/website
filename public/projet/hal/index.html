<!DOCTYPE html>
<html lang="fr-fr">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">
<meta itemprop="name" content="HAL (Projet universitaire, C# dotnet core 3.0)">
<meta itemprop="description" content="Lien Github
Contents  Intro  Prérequis QuickStart  Utilisation du serveur avec Docker     Choix Installations  Serveur  Docker  Exigence Installation avec Docker   Installation Manuelle  Installation     Client  Installation Manuelle     Serveur Docker Documentation  Docker-Compose du serveur  Volumes du serveur Variables d&rsquo;environnement   Mise à jour du Docker InfluxDB  Présentation Installation InfluxDB Volumes InfluxDB InfluxDB API InfluxQL Liaison avec HAL   Grafana  Présentation Grafana Installation Grafana Volumes Grafana Présentation rapide de l&rsquo;interface  Data Source   Grafana et InfluxQL   Tout-en-un   Serveur Installation Manuelle  Installation Manuelle Linux Installation Manuelle Windows   Client Installation  Installation Manuelle Linux Installation Manuelle Windows Configuration  Comprendre config."><meta itemprop="datePublished" content="2020-07-07T00:00:00+02:00" />
<meta itemprop="dateModified" content="2020-07-07T00:00:00+02:00" />
<meta itemprop="wordCount" content="5565"><meta itemprop="image" content="https://rachartier.github.io/background_meta.jpg"/>
<meta itemprop="keywords" content="" /><meta property="og:title" content="HAL (Projet universitaire, C# dotnet core 3.0)" />
<meta property="og:description" content="Lien Github
Contents  Intro  Prérequis QuickStart  Utilisation du serveur avec Docker     Choix Installations  Serveur  Docker  Exigence Installation avec Docker   Installation Manuelle  Installation     Client  Installation Manuelle     Serveur Docker Documentation  Docker-Compose du serveur  Volumes du serveur Variables d&rsquo;environnement   Mise à jour du Docker InfluxDB  Présentation Installation InfluxDB Volumes InfluxDB InfluxDB API InfluxQL Liaison avec HAL   Grafana  Présentation Grafana Installation Grafana Volumes Grafana Présentation rapide de l&rsquo;interface  Data Source   Grafana et InfluxQL   Tout-en-un   Serveur Installation Manuelle  Installation Manuelle Linux Installation Manuelle Windows   Client Installation  Installation Manuelle Linux Installation Manuelle Windows Configuration  Comprendre config." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rachartier.github.io/projet/hal/" /><meta property="og:image" content="https://rachartier.github.io/background_meta.jpg"/><meta property="article:section" content="Projet" />
<meta property="article:published_time" content="2020-07-07T00:00:00+02:00" />
<meta property="article:modified_time" content="2020-07-07T00:00:00+02:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://rachartier.github.io/background_meta.jpg"/>

<meta name="twitter:title" content="HAL (Projet universitaire, C# dotnet core 3.0)"/>
<meta name="twitter:description" content="Lien Github
Contents  Intro  Prérequis QuickStart  Utilisation du serveur avec Docker     Choix Installations  Serveur  Docker  Exigence Installation avec Docker   Installation Manuelle  Installation     Client  Installation Manuelle     Serveur Docker Documentation  Docker-Compose du serveur  Volumes du serveur Variables d&rsquo;environnement   Mise à jour du Docker InfluxDB  Présentation Installation InfluxDB Volumes InfluxDB InfluxDB API InfluxQL Liaison avec HAL   Grafana  Présentation Grafana Installation Grafana Volumes Grafana Présentation rapide de l&rsquo;interface  Data Source   Grafana et InfluxQL   Tout-en-un   Serveur Installation Manuelle  Installation Manuelle Linux Installation Manuelle Windows   Client Installation  Installation Manuelle Linux Installation Manuelle Windows Configuration  Comprendre config."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>HAL (Projet universitaire, C# dotnet core 3.0)</title>
	<link rel="stylesheet" href="https://rachartier.github.io/css/style.min.3a0198c64bfa5b2948f541f6c749ba1fa59a92b1df1074d6098211f5a2f77d27.css" integrity="sha256-OgGYxkv6WylI9UH2x0m6H6WakrHfEHTWCYIR9aL3fSc=" crossorigin="anonymous">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://rachartier.github.io/">Raphaël CHARTIER</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					
				<a href="https://rachartier.github.io/projet/">Projets</a>
				<a href="https://rachartier.github.io/code/">Mon bac à sable</a>
				<a href="https://rachartier.github.io/cv/">CV</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<span class="hdr-social hide-in-mobile"><a href="https://www.linkedin.com/in/rapha%C3%ABl-chartier-3916581ab/" target="_blank" rel="noopener me" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a><a href="https://github.com/rachartier" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://rachartier.github.io/projet/">Projets</a></li>
			<li><a href="https://rachartier.github.io/code/">Mon bac à sable</a></li>
			<li><a href="https://rachartier.github.io/cv/">CV</a></li>
		</ul>
	</div>


	<main class="site-main section-inner thin animated fadeIn faster">
		<h1>HAL (Projet universitaire, C# dotnet core 3.0)</h1>
		<div class="content">
			<h2 id="lien">Lien<a href="#lien" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p><a href="https://github.com/rachartier/hal">Github</a></p>
<h2 id="contents">Contents<a href="#contents" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<ul>
<li><a href="#intro">Intro</a>
<ul>
<li><a href="#pr%C3%A9requis">Prérequis</a></li>
<li><a href="#quickstart">QuickStart</a>
<ul>
<li><a href="#utilisation-du-serveur-avec-docker">Utilisation du serveur avec Docker</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#choix-installations">Choix Installations</a>
<ul>
<li><a href="#serveur">Serveur</a>
<ul>
<li><a href="#docker">Docker</a>
<ul>
<li><a href="#exigence">Exigence</a></li>
<li><a href="#installation-avec-docker">Installation avec Docker</a></li>
</ul>
</li>
<li><a href="#installation-manuelle">Installation Manuelle</a>
<ul>
<li><a href="#installation">Installation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#client">Client</a>
<ul>
<li><a href="#installation-manuelle-1">Installation Manuelle</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#serveur-docker-documentation">Serveur Docker Documentation</a>
<ul>
<li><a href="#docker-compose-du-serveur">Docker-Compose du serveur</a>
<ul>
<li><a href="#volumes-du-serveur">Volumes du serveur</a></li>
<li><a href="#variables-denvironnement">Variables d&rsquo;environnement</a></li>
</ul>
</li>
<li><a href="#mise-%C3%A0-jour-du-docker">Mise à jour du Docker</a></li>
<li><a href="#influxdb">InfluxDB</a>
<ul>
<li><a href="#pr%C3%A9sentation">Présentation</a></li>
<li><a href="#installation-influxdb">Installation InfluxDB</a></li>
<li><a href="#volumes-influxdb">Volumes InfluxDB</a></li>
<li><a href="#influxdb-api">InfluxDB API</a></li>
<li><a href="#influxql">InfluxQL</a></li>
<li><a href="#liaison-avec-hal">Liaison avec HAL</a></li>
</ul>
</li>
<li><a href="#grafana">Grafana</a>
<ul>
<li><a href="#pr%C3%A9sentation-grafana">Présentation Grafana</a></li>
<li><a href="#installation-grafana">Installation Grafana</a></li>
<li><a href="#volumes-grafana">Volumes Grafana</a></li>
<li><a href="#pr%C3%A9sentation-rapide-de-linterface">Présentation rapide de l&rsquo;interface</a>
<ul>
<li><a href="#data-source">Data Source</a></li>
</ul>
</li>
<li><a href="#grafana-et-influxql">Grafana et InfluxQL</a></li>
</ul>
</li>
<li><a href="#tout-en-un">Tout-en-un</a></li>
</ul>
</li>
<li><a href="#serveur-installation-manuelle">Serveur Installation Manuelle</a>
<ul>
<li><a href="#installation-manuelle-linux">Installation Manuelle Linux</a></li>
<li><a href="#installation-manuelle-windows">Installation Manuelle Windows</a></li>
</ul>
</li>
<li><a href="#client-installation">Client Installation</a>
<ul>
<li><a href="#installation-manuelle-linux-1">Installation Manuelle Linux</a></li>
<li><a href="#installation-manuelle-windows-1">Installation Manuelle Windows</a></li>
<li><a href="#configuration">Configuration</a>
<ul>
<li><a href="#comprendre-configjson-et-config_localjson">Comprendre <code>config.json</code> et <code>config_local.json</code></a></li>
<li><a href="#configurer-le-serveur-pour-le-client">Configurer le serveur pour le client</a>
<ul>
<li><a href="#changement-dip-et-de-port">Changement d&rsquo;ip et de port</a></li>
</ul>
</li>
<li><a href="#configurer-le-serveur">Configurer le serveur</a></li>
<li><a href="#configurer-le-client">Configurer le client</a>
<ul>
<li><a href="#attributs">Attributs</a></li>
<li><a href="#mode-administrateur">Mode administrateur</a></li>
<li><a href="#mode-differencial">Mode differencial</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#configuration-des-clients-par-le-serveur">Configuration des clients par le serveur</a></li>
<li><a href="#r%C3%A9daction-plugins">Rédaction plugins</a>
<ul>
<li><a href="#difference-entre-assemblydll-dll-classique-shared-object-et-script">Difference entre AssemblyDLL, DLL classique, shared object et script</a></li>
<li><a href="#r%C3%A9daction-de-plugins-via-langages-support%C3%A9s-par-d%C3%A9faut">Rédaction de plugins via langages supportés par défaut</a>
<ul>
<li><a href="#exemple-en-cc-dll-classique-shared-object">Exemple en C/C++ (DLL classique, Shared Object)</a></li>
<li><a href="#exemple-en-c-assemblydll">Exemple en C# (AssemblyDLL)</a></li>
<li><a href="#exemple-en-go-script--dll-classique">Exemple en GO (Script / DLL classique)</a></li>
<li><a href="#exemple-en-python-script">Exemple en Python (Script)</a></li>
</ul>
</li>
<li><a href="#via-langage-non-support%C3%A9-par-d%C3%A9faut-et-scripts-windows">Via langage non supporté par défaut (ET scripts Windows)</a>
<ul>
<li><a href="#ajout-dun-interpreteur-via-fichier-de-configuration">Ajout d&rsquo;un interpreteur via fichier de configuration</a></li>
<li><a href="#ajout-dune-extension-de-plugin-personnalis%C3%A9e">Ajout d&rsquo;une extension de plugin personnalisée</a></li>
<li><a href="#ajout-din-interpreteur-via-variables-denvironnements">Ajout d&rsquo;in interpreteur via variables d&rsquo;environnements</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#v%C3%A9rification-des-sorties-des-plugins">Vérification des sorties des plugins</a>
<ul>
<li><a href="#pr%C3%A9sentation-du-plugins_checker">Présentation du plugins_checker</a></li>
</ul>
</li>
<li><a href="#configurer-les-sauvegardes-des-r%C3%A9sultats">Configurer les sauvegardes des résultats</a></li>
</ul>
</li>
</ul>
<h1 id="intro">Intro<a href="#intro" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<p>HAL est un projet de supervision destiné à récupérer différents donnés d&rsquo;un parc informatique et à les envoyer sur un serveur, dans le but d&rsquo;agréger les données en vue des traiter.
Il utilise un système de plugins, qui sont chargés automatiquement au démarrage du client. Plusieurs langages pour écrire les plugins sont supportés:</p>
<ul>
<li>C/C++/C#/Go (.dll / .so)</li>
<li>Go Script (.go)</li>
<li>Python (.py)</li>
<li>Ruby (.rb)</li>
<li>Shell (.sh)</li>
<li>Powershell (.ps1)</li>
</ul>
<p>Et d&rsquo;autres peuvent être ajoutés manuellement si besoin.</p>
<p>Les plugins sont déposés dans le dossier &ldquo;plugins&rdquo;, qui est un dossier spécial scanné permettant de charger automatiquement tous les plugins qui s&rsquo;y trouvent.</p>
<p>HAL est destiné à tout utilisateur voulant superviser les ordinateurs sur un réseau.</p>
<h2 id="prérequis">Prérequis<a href="#prérequis" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Pour le bon fonctionnement de HAL, il faut impérativement avoir</p>
<ul>
<li><a href="https://dotnet.microsoft.com/">.NET Core 3.x</a>, (serveur/client)</li>
<li><a href="https://www.python.org/downloads/">Python 3.x</a> (client, si vous souhaitez utiliser des plugins en python)</li>
<li><a href="https://www.ruby-lang.org/fr/downloads/">Ruby</a> (client, si vous souhaitez utiliser des plugins en ruby)</li>
<li><a href="https://golang.org/">Go</a> (client, si vous souhaitez utiliser des plugins en go)</li>
</ul>
<p>Ou des erreurs peuvent subvenir pendant l&rsquo;éxecution des plugins.</p>
<h2 id="quickstart">QuickStart<a href="#quickstart" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<h3 id="utilisation-du-serveur-avec-docker">Utilisation du serveur avec Docker<a href="#utilisation-du-serveur-avec-docker" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ol>
<li>Télécharger la dernière image docker du serveur <a href="https://dockerhub.iut-clermont.uca.fr/ui/library/hal_hal-server_dotnet3.1">dockerhub.iut-clermont.uca.fr</a></li>
</ol>
<p><code>docker pull dockerhub.iut-clermont.uca.fr:443/hal_hal-server_dotnet3.1:latest</code></p>
<ol start="2">
<li>
<p>Télécharger le <a href="/dev/docker/server">docker-compose</a> par défaut du serveur</p>
</li>
<li>
<p>Lancer le docker-compose
<code>docker-compose up \chemin du docker-compose du serveur\</code>
NB: Si vous n&rsquo;avez pas installé docker-compose suivez ce lien <a href="https://docs.docker.com/compose/install/">docs.docker.com</a></p>
</li>
</ol>
<p>Pour plus d&rsquo;information concernant le docker-compose et sa configuration, référez vous au <a href="dev/docker">README</a> du dossier docker du projet.</p>
<p>Une fois le serveur lancé vous pouvez commencer à utilisé le serveur HAL. Par défaut le port de connexion de HAL est le port 11000 et l&rsquo;IP par défaut et l&rsquo;IP local.</p>
<p>Vous pouvez maintenant commencer à écrire vos propres plugins afin de les transférer aux clients.</p>
<h1 id="choix-installations">Choix Installations<a href="#choix-installations" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<p>Plusieurs possibilités existe afin d&rsquo;installer le serveur et le client HAL. Nous recommandons toujours quant c&rsquo;est possible, l&rsquo;installation Docker.</p>
<h2 id="serveur">Serveur<a href="#serveur" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<h3 id="docker">Docker<a href="#docker" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>L&rsquo;installation Docker du serveur est l&rsquo;installation recommandé.</p>
<p>Le serveur peut être utilisé via un conteneur Docker disponible sur <a href="https://dockerhub.iut-clermont.uca.fr/ui/library/hal_hal-server_dotnet3.1">dockerhub.iut-clermont.uca.fr/ui/library/hal_hal-server_dotnet3.1</a>.
Pour plus d&rsquo;informations se référer au <a href="dev/docker">README</a> disponible dans le dossier dev/docker/</p>
<p>Si vous souhaiter utiliser le serveur avec grafana et influxdb il faudra alors utiliser le docker-compose approprié, lien vers la <a href="dev/docker/influxdb-grafana-hal-server">documentation</a></p>
<h4 id="exigence">Exigence<a href="#exigence" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>Afin d&rsquo;installer correctement le serveur vous devrez avoir:</p>
<ul>
<li><a href="https://docs.docker.com/engine/install/">Docker</a> (v19.0 min)</li>
<li><a href="https://docs.docker.com/compose/install/">Docker-Compose</a></li>
</ul>
<h4 id="installation-avec-docker">Installation avec Docker<a href="#installation-avec-docker" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>L&rsquo;image docker du serveur est présente sur le docker hub de l&rsquo;IUT: <a href="https://dockerhub.iut-clermont.uca.fr/ui/library/hal_hal-server_dotnet3.1">https://dockerhub.iut-clermont.uca.fr/ui/library/hal_hal-server_dotnet3.1</a></p>
<p>Pour plus d&rsquo;information sur l&rsquo;installation du docker du serveur se référer à cette <a href="#docker-compose-du-serveur">documentation</a>.</p>
<h3 id="installation-manuelle">Installation Manuelle<a href="#installation-manuelle" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>L&rsquo;installation manuelle du serveur est possible de plusieurs façon, soit avec un service/daemon ou bien manuellement et non-automatique.</p>
<h4 id="installation">Installation<a href="#installation" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>Des dossiers sont fournis dans l&rsquo;onglet release du projet Git, dans ces dossiers zippé on retrouve l&rsquo;exécutable du serveur, sous linux il suffira de lancer en ligne de commande le serveur avec la commande <code>./server</code> (si vous lancez la commande dans le même dossier) ou bien de configurer le daemon fournis dans les dossiers du projet Git (lien vers daemons).</p>
<p>Pour plus d&rsquo;information se référer à la <a href="#serveur-installation-manuelle">documentation</a> un peu plus bas.</p>
<h2 id="client">Client<a href="#client" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Pas d&rsquo;installation docker disponible pour le Docker pour le moment, nous n&rsquo;avons pas trouvé ça utile de fournir un lancement conteneurisé pour le client.
Uniquement une installation manuelle est fournis dans la documentation.</p>
<h3 id="installation-manuelle-1">Installation Manuelle<a href="#installation-manuelle-1" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Comme pour le serveur, le dossier zippé du client sera disponible dans l&rsquo;onglet release du projet Git, dedans on retrouvera l&rsquo;exécutable du client, sous linux il suffire de lancer en ligne de commande le serveur avec la commande <code>./client</code> (si vous lancez la commande dans le même dossier) ou bien de configurer le daemon fournis dans les dossiers du projet Git <a href="https://github.com/rachartier/hal/tree/master/dev/daemon">https://github.com/rachartier/hal/tree/master/dev/daemon</a>.</p>
<p>Pour plus d&rsquo;information se référer à la <a href="#client-installation">documentation</a> un peu plus bas.</p>
<h1 id="serveur-docker-documentation">Serveur Docker Documentation<a href="#serveur-docker-documentation" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<h2 id="docker-compose-du-serveur">Docker-Compose du serveur<a href="#docker-compose-du-serveur" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Le docker-compose de l&rsquo;application actuelle est disponible sur <a href="/docker/server/docker-compose.yml">/docker/server/docker-compose.yml</a>.</p>
<p>Le container du serveur, quant à lui, est disponible en publique sur <a href="https://dockerhub.iut-clermont.uca.fr/ui/library/hal_hal-server_dotnet3.1">dockerhub.iut-clermont.uca.fr/ui/library/hal_hal-server_dotnet3.1</a>.</p>
<p>La configuration du docker-compose est comme suit:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3.3&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">hal</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">dockerhub.iut-clermont.uca.fr:443/hal_hal-server_dotnet3.1:latest</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;11000:11000&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">          </span>- <span class="l">/data/TMP/hal/results:/data</span><span class="w">
</span><span class="w">          </span>- <span class="l">/data/TMP/hal/plugins:/plugins</span><span class="w">
</span><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">IP_HAL</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.0.0.0&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">PORT_HAL</span><span class="p">:</span><span class="w"> </span><span class="m">11000</span><span class="w">
</span><span class="w">      </span><span class="nt">MAX_THREADS_HAL</span><span class="p">:</span><span class="w"> </span><span class="m">8</span><span class="w">
</span><span class="w">      </span><span class="nt">UPDATE_RATE_HAL</span><span class="p">:</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="w">      </span><span class="nt">SAVE_PATH_HAL</span><span class="p">:</span><span class="w"> </span><span class="l">/data</span><span class="w">
</span></code></pre></div><h3 id="volumes-du-serveur">Volumes du serveur<a href="#volumes-du-serveur" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Côté <strong>hôte</strong>, on a deux volumes: <code>/data/TMP/hal/results</code> qui correspond au dossier contenant les résultats des plugins exécuté dans les clients de HAL. Vous pouvez le changer comme vous le voulez, cependant le volume côté <strong>conteneur</strong> ne devra pas changer <code>/data</code>.</p>
<p>Le second volume: <code>/data/TMP/hal/plugins</code> correspond au dossier contenant les plugins à envoyer aux clients de HAL. Vous pouvez également le changer comme vous le voulez, cependant le volume côté <strong>conteneur</strong> ne devra pas être changer <code>/plugins</code>.</p>
<h3 id="variables-denvironnement">Variables d&rsquo;environnement<a href="#variables-denvironnement" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Le docker-compose est composé de variables d&rsquo;environnement, ces variables servent à modifier la configuration du serveur:</p>
<ul>
<li>IP_HAL: La variable d&rsquo;environnement indiquant l&rsquo;adresse IP du serveur.</li>
<li>PORT_HAL: La variable d&rsquo;environnement qui indique le port ou le serveur iras pointer pour les clients et la communication. <strong>/!\ Si cette variables est changé, ne pas oublier de modifier également le port du conteneur dans le docker-compose.yml (champs &lsquo;ports&rsquo; du docker-compose ci-dessus) /!\</strong></li>
<li>MAX_THREADS_HAL: La variable d&rsquo;environnement qui indique le nombre max de threads utilisé par le serveur HAL.</li>
<li>UPDATE_RATE_HAL: La variable d&rsquo;environnement qui indique la fréquence des updates en millisecondes.</li>
<li>SAVE_PATH_HAL: C&rsquo;est le chemin où seront sauvegarder les données récoltés par les plugins dans le container du serveur HAL.</li>
</ul>
<h2 id="mise-à-jour-du-docker">Mise à jour du Docker<a href="#mise-à-jour-du-docker" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Pour mettre à jour le conteneur, il suffit simplement de se placer dans le même dossier que le docker-compose.yml du serveur est de rentrer cette commande: <code>docker-compose pull</code>. Cela mettra à jour automatiquement l&rsquo;image présente dans le docker-compose.yml du dossier ou vous vous trouver.</p>
<p>Ici il mettra à jour l&rsquo;image: <code>dockerhub.iut-clermont.uca.fr:443/hal_hal-server_dotnet3.1:latest</code></p>
<p>Et pour lancer le serveur via le docker-compose, il suffit de lancer <code>docker-compose up</code> ou <code>docker-compose up -d</code> pour un lancement en mode démon.</p>
<h2 id="influxdb">InfluxDB<a href="#influxdb" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>InfluxDB est système de gestion de base de donnée orientée données dite &lsquo;timeseries&rsquo;, c&rsquo;est-à-dire qu&rsquo;il s&rsquo;agit de base de donnée contenant des données horodatée. Il possède une gestion haute performance et une API permettant de faire des requêtes de donnée au sein même des bases, et ceux grâce à leur langage de requête nommé InfluxQL.</p>
<h3 id="présentation">Présentation<a href="#présentation" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>InfluxDB est l&rsquo;une des solutions proposé pour stocker les données de récoltées par HAL, voir la documentation sur les <a href="/tree/master/#stockage">stockages</a>. Notre documentation fournis un ensemble &lsquo;ready to go&rsquo; permettant de lancer le serveur HAL avec Grafana et InfluxDB connecté.</p>
<h3 id="installation-influxdb">Installation InfluxDB<a href="#installation-influxdb" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Nous n&rsquo;avons pas fournis de solution d&rsquo;installation manuelle pour InfluxDB. Ni même de docker-compose indépendant. Cependant vous pouvez créer votre propre docker-compose indépendant pour votre influxDB si vous souhaitez l&rsquo;installer sur un serveur distant.</p>
<p>Le service d&rsquo;influxdb au sein du docker-compose se résume comme suit:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="nt">influxdb</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">influxdb:latest</span><span class="w">
</span><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;8083:8083&#34;</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;8086:8086&#34;</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;8090:8090&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="s1">&#39;env.influxdb&#39;</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="c"># Data persistency</span><span class="w">
</span><span class="w">      </span><span class="c"># sudo mkdir -p /srv/docker/influxdb/data</span><span class="w">
</span><span class="w">      </span>- <span class="l">/srv/docker/influxdb/data:/var/lib/influxdb</span><span class="w">
</span></code></pre></div><p>Le port 8083 d&rsquo;influxDB correspond à l&rsquo;interface web administrateur, vous pouvez bien sur redirigé le port hôte vers un autre port souhaité.
Le port 8086 d&rsquo;influxDB correspond à l&rsquo;API exposé en HTTP, c&rsquo;est ce port qui sera utilisé par Grafana afin d&rsquo;accéder aux données.</p>
<p>NB: Si le conteneur d&rsquo;influxDB est situé dans le même docker-compose que celui de Grafana, il n&rsquo;est pas obligatoire d&rsquo;exposé l&rsquo;API afin que tout fonctionne correctement, cependant de cette manière vous ne pourrez pas débugger depuis l&rsquo;extérieur du réseaux interne du docker-compose.</p>
<p>Pour une installation manuelle de InfluxDB, la <a href="https://docs.influxdata.com/influxdb/v1.8/introduction/install/">documentation</a> d&rsquo;influxDB est très bien faite et pourras vous aidez à déployer la solution souhaité.</p>
<h3 id="volumes-influxdb">Volumes InfluxDB<a href="#volumes-influxdb" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Vous devrez monter un volume sur votre hôte si vous voulez accéder aux données persisté dans le conteneur.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="c"># Data persistency</span><span class="w">
</span><span class="w">      </span><span class="c"># sudo mkdir -p /srv/docker/influxdb/data</span><span class="w">
</span><span class="w">      </span>- <span class="l">/srv/docker/influxdb/data:/var/lib/influxdb</span><span class="w">
</span></code></pre></div><p>Par défaut le chemin vers les données persistés côté hôte est: <code>/srv/docker/influxdb/data</code> créé le avec la commande <code>sudo mkdir -p /srv/docker/influxdb/data</code>.</p>
<p>Plus d&rsquo;information sur les spécificités du conteneur influxdb sur <a href="https://hub.docker.com/_/influxdb">la documentation officielle</a>.</p>
<h3 id="influxdb-api">InfluxDB API<a href="#influxdb-api" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>L&rsquo;API d&rsquo;influxDB est essentiel pour la compréhension de Grafana par la suite. En effet, Grafana se servira de cette API afin de communiquer avec la base, il est donc important d&rsquo;en comprendre les principes.</p>
<p>Pour pouvoir regarder toute les bases de données disponible au sein de la base influxDB: <code>curl -G http://localhost:8086/query --data-urlencode &quot;q=SHOW DATABASES&quot;</code></p>
<p>Bien sur <code>localhost</code> est à remplacé par l&rsquo;adresse de votre serveur influxDB qu&rsquo;il soit conteneurisé ou non.</p>
<p>Pour créer une base de donnée: <code>curl -i -XPOST http://localhost:8086/query --data-urlencode &quot;q=CREATE DATABASE hal_data&quot;</code></p>
<p>On peut également créer des données à ajouter directement dans les bases que l&rsquo;on vient de créer, et tout ça en ligne de commande grâce à l&rsquo;API disponible de InfluxDB:
<code>curl -i -XPOST 'http://localhost:8086/write?db=hal_data' --data-binary 'cpu_load_short,host=server01,region=us-west value=0.64 1434055562000000000'</code></p>
<p>Ici on ajoute une valeur à la colonne <code>cpu_load_short</code> dans la base <code>hal_data</code> créée précédemment.</p>
<p>Pour plus d&rsquo;information concernant le endpoint <code>/write</code>, la documentation se trouve <a href="https://docs.influxdata.com/influxdb/v1.7/tools/api/#write-http-endpoint">ici</a></p>
<p><a href="https://docs.influxdata.com/influxdb/v1.8/guides/write_data/">Ici</a> vous pouvez retrouver de la documentation et un guide sur l&rsquo;écriture des données dans les bases de InfluxDB.</p>
<p>Si vous voulez tester HAL en utilisant Grafana et InfluxDB avec l&rsquo;aide de l&rsquo;API vous devrez:</p>
<ul>
<li>Créer la bdd <code>hal_data</code> (<code>curl -i -XPOST http://localhost:8086/query --data-urlencode &quot;q=CREATE DATABASE hal_data&quot;</code>)</li>
<li>Vérifier qu&rsquo;elle est bien été ajouté (<code>curl -G http://localhost:8086/query --data-urlencode &quot;q=SHOW DATABASES&quot;</code>)</li>
</ul>
<h3 id="influxql">InfluxQL<a href="#influxql" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>La documentation officielle du langage créé par InfluxDB se trouve <a href="https://docs.influxdata.com/influxdb/v1.8/query_language/">ici</a>.</p>
<p>Si on reprend notre exemple, avec l&rsquo;API précédemment montré nous avons déjà utiliser du InfluxQL. Donc de cette même manière nous pouvons faire des requêtes sur la base comme ceci:</p>
<p><code>curl -G &quot;http://localhost:8086/query?pretty=true&quot; --data-urlencode &quot;db=hal_data&quot; --data-urlencode &quot;q=SELECT &quot;result&quot; FROM &quot;connected_user&quot; WHERE time &gt;= now() - 30m&quot;</code></p>
<p>Ce qui nous renverras la colonne &lsquo;result&rsquo; de &lsquo;connected_user&rsquo; dans la base &lsquo;hal_data&rsquo; créé précédemment.</p>
<p>Par la suite nous pourrons voir l&rsquo;utilisation d&rsquo;influxQL avec Grafana.</p>
<h3 id="liaison-avec-hal">Liaison avec HAL<a href="#liaison-avec-hal" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Les clients de HAL devront pousser les données dans la base de donnée voulu de InfluxDB.</p>
<p>Afin de lier InfluxDB avec HAL il vous faudra modifié le fichier <code>config_local.json</code> du côté du serveur:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml">{<span class="w">
</span><span class="w">  </span><span class="nt">&#34;server&#34;: </span>{<span class="w">
</span><span class="w">    </span><span class="nt">&#34;ip&#34;: </span><span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="nt">&#34;port&#34;: </span><span class="m">11000</span><span class="w">
</span><span class="w">  </span>}<span class="p">,</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;storage&#34;: </span><span class="p">[</span><span class="w">
</span><span class="w">    </span><span class="s2">&#34;influxdb&#34;</span><span class="w">
</span><span class="w">  </span><span class="p">],</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;database&#34;: </span>{<span class="w">
</span><span class="w">    </span><span class="nt">&#34;connectionString&#34;: </span><span class="p">[</span><span class="w">
</span><span class="w">        </span><span class="s2">&#34;http://localhost:8086/&#34;</span><span class="w">
</span><span class="w">    </span><span class="p">]</span><span class="w">
</span><span class="w">  </span>}<span class="w">
</span><span class="w"></span>}<span class="w">
</span></code></pre></div><p>Pour plus d&rsquo;information sur <code>config_local.json</code> veuillez vous réferer à &ldquo;<a href="#comprendre-configjson-et-config_localjson">Comprendre <code>config.json</code> et <code>config_local.json</code></a>&rdquo;</p>
<h2 id="grafana">Grafana<a href="#grafana" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Grafana est un logiciel libre qui permet la visualisation des données. On peut y effectuer des tableaux de bords avancés et également avoir un système d&rsquo;alerte au sein même de ceux-ci. Il possède aussi une gestion des droits fines pouvant être configuré aisement via son interface web. Il peut être utilisé avec plusieurs Base de donnée mais surtout avec des BDD horodatée comme InfluxDB.</p>
<h3 id="présentation-grafana">Présentation Grafana<a href="#présentation-grafana" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Grafana est une solution retenue afin d&rsquo;obtenir une metrologie plus poussé de HAL, il permet d&rsquo;éffectuer des requêtes à InfluxDB et de pouvoir agencer des tableaux de bords simple d&rsquo;utilisation. Cependant il faudra avoir une connaissance du langage <a href="#influxql">InfluxQL</a>. Notre documentation fournis un ensemble &lsquo;ready to go&rsquo; permettant de lancer le serveur HAL avec Grafana et InfluxDB connecté.</p>
<h3 id="installation-grafana">Installation Grafana<a href="#installation-grafana" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Nous n&rsquo;avons pas fournis de solution d&rsquo;installation manuelle pour Grafana. Ni même de docker-compose indépendant. Cependant vous pouvez créer votre propre docker-compose indépendant pour votre Grafana si vous souhaitez l&rsquo;installer sur un serveur distant.</p>
<p>/!\ Cependant gardé en tête que la documentation s&rsquo;appuie sur le fait que les conteneurs sont situé dans le même réseau, si vous souhaitez faire des instances séparées de chacun vous devrez adapté certains éléments de la documentation à votre propre projet /!\</p>
<p>Le service de grafana au sein du docker-compose se résume comme suit:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="nt">grafana</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">grafana/grafana:latest</span><span class="w">
</span><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;3000:3000&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">links</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">influxdb</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="c"># Data persistency</span><span class="w">
</span><span class="w">      </span><span class="c"># sudo mkdir -p /srv/docker/grafana/data; chown 472:472 /srv/docker/grafana/data</span><span class="w">
</span><span class="w">      </span>- <span class="l">/srv/docker/grafana/data:/var/lib/grafana</span><span class="w">
</span></code></pre></div><p>Le port 3000 de Grafana correspond à l&rsquo;interface web.</p>
<p>S&rsquo;ils se trouvent dans le même docker-compose, grafana est lié au lancement du service influxDB (cette partie est optionnelle si docker-compose différent).</p>
<h3 id="volumes-grafana">Volumes Grafana<a href="#volumes-grafana" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Vous devrez monter un volume sur votre hôte si vous voulez accèder aux données persisté dans le conteneur.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="c"># Data persistency</span><span class="w">
</span><span class="w">      </span><span class="c"># sudo mkdir -p /srv/docker/grafana/data; chown 472:472 /srv/docker/grafana/data</span><span class="w">
</span><span class="w">      </span>- <span class="l">/srv/docker/grafana/data:/var/lib/grafana</span><span class="w">
</span></code></pre></div><p>Créé le volume côté hôte, par défaut le chemin de l&rsquo;hôte est <code>/srv/docker/grafana/data</code>, créé le avec la commande <code>sudo mkdir -p /srv/docker/grafana/data</code> puis changé le propriétaire du dossier en 472 avec la commande <code>chown 472:472 /srv/docker/grafana/data</code>. 472 est l&rsquo;utilisateur par défaut dans les versions de grafana &gt;=5.1 (en dessous l&rsquo;utilisateur par défaut est le 104).</p>
<p>Plus d&rsquo;information sur la documentation officielle du <a href="https://grafana.com/docs/grafana/latest/installation/docker/">docker grafana</a>.</p>
<h3 id="présentation-rapide-de-linterface">Présentation rapide de l&rsquo;interface<a href="#présentation-rapide-de-linterface" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p><img src="dev/docker/influxdb-grafana-hal-server/imgs/login_grafana.png" alt="login grafana page"></p>
<p>Voici la page de login, par défaut il existe un utilisateur admin avec le mot de passe admin.</p>
<p>Par la suite Grafana vous redirigeras vers la page principale, ou tout le processus pour un bon début y est présenté. La première étape à faire et de configurer le <strong>Data Source</strong> et de le configurer sur la base influxdb de votre conteneur.</p>
<h4 id="data-source">Data Source<a href="#data-source" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p><img src="dev/docker/influxdb-grafana-hal-server/imgs/data_source.png" alt="data source grafana page"></p>
<p>Selectionné InfluxDB</p>
<p><img src="dev/docker/influxdb-grafana-hal-server/imgs/configuration_datasource.png" alt="config data source grafana page"></p>
<p>En fonction de votre configuration du docker-compose, vous pourrez soit passer par un accès Navigateur (Browser) ou Serveur par défaut. Plus d&rsquo;information sur comment configurer votre data source Grafana vers InfluxDB sur la <a href="https://grafana.com/docs/grafana/latest/features/datasources/influxdb/">documentation officielle</a></p>
<p>Ce qu&rsquo;il y a à retenir pour l&rsquo;accès c&rsquo;est si vous mettez Server=l&rsquo;URL doit être accessible depuis le serveur de Grafana; et si vous mettez Browser=l&rsquo;URL doit être accessible via le navigateur.</p>
<p>L&rsquo;URL renseigné dépend donc de votre configuration du docker-compose, cependant s&rsquo;il est équivalent au notre et que l&rsquo;influxDB se situe dans le même réseaux que le grafana alors l&rsquo;url sera -&gt; http://localhost:8086</p>
<p><strong>InfluxDB Details</strong> dépend la aussi de votre configuration précédente, ici le nom de la base de donné sera celle par défaut, càd <code>hal_data</code>.</p>
<h3 id="grafana-et-influxql">Grafana et InfluxQL<a href="#grafana-et-influxql" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Maintenant que tout est configuré il ne reste plus qu&rsquo;a découvrir l&rsquo;interface de requetage de Grafana !</p>
<p><img src="dev/docker/influxdb-grafana-hal-server/imgs/influxql.png" alt="config data source grafana page"></p>
<p>On peut maintenant créer une créer une première vue et exposé les données dans un petit tableau dans grafana:</p>
<p><img src="dev/docker/influxdb-grafana-hal-server/imgs/connected_users.png" alt="config data source grafana page"></p>
<p>Ici on utilise les résultats du plugins <strong>connected_users</strong>, et bien sur la requête exposé est équivalente à l&rsquo;appel API : <code>curl -G &quot;http://localhost:8086/query?pretty=true&quot; --data-urlencode &quot;db=hal_data&quot; --data-urlencode &quot;q=SELECT &quot;result&quot; FROM &quot;connected_user&quot; WHERE time &gt;= now() - 30m&quot;</code></p>
<h2 id="tout-en-un">Tout-en-un<a href="#tout-en-un" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Un docker-compose est disponible afin d&rsquo;utiliser l&rsquo;ensemble des solutions avec le serveur HAL; soit Grafana, influxDB et HAL.
La documentation de <a href="#grafana">Grafana</a> et <a href="#influxdb">influxDB</a> servent à comprendre comment grafana et influxdb fonctionne au sein du docker-compose. Il suffit de rajouter le serveur HAL afin de le lié à la base et à grafana. Le docker-compose est déjà disponible au sein du projet.</p>
<p>Voici le processus pour tester l&rsquo;ensemble en <strong>local</strong> par exemple :</p>
<ul>
<li>Enlever HAL SERVER du docker-compose (seulement si le test est en local !) et le lancer manuellement.</li>
<li>Écrire la bonne configuration pour la base de donnée influxdb dans le config_local.json</li>
<li>Créer la base de donnée &lsquo;hal_data&rsquo; (<code>curl -i -XPOST http://localhost:8086/query --data-urlencode &quot;q=CREATE DATABASE hal_data&quot;</code>)</li>
<li>Vérifier que la base ai bien été crée (<code>curl -G http://localhost:8086/query --data-urlencode &quot;q=SHOW DATABASES&quot;</code>)</li>
<li>Se connecter à Grafana sur &lsquo;localhost:3000&rsquo; en utilisant l&rsquo;utilisateur administrateur</li>
<li>Interroger la base avec de l&rsquo;InfluxQL depuis Grafana</li>
<li>Crée vos propres dashboard</li>
</ul>
<h1 id="serveur-installation-manuelle">Serveur Installation Manuelle<a href="#serveur-installation-manuelle" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<p>Plusieurs façons existe afin de lancer manuellement le serveur, bien qu&rsquo;il soit recommandé de l&rsquo;utiliser via Docker.</p>
<h2 id="installation-manuelle-linux">Installation Manuelle Linux<a href="#installation-manuelle-linux" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Il existe un service init.d pour le serveur disponible dans les fichiers du projets.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="p">[</span><span class="l">Unit]</span><span class="w">
</span><span class="w"></span><span class="l">Description=HAL server daemon</span><span class="w">
</span><span class="w"></span><span class="l">After=network-online.target</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="p">[</span><span class="l">Service]</span><span class="w">
</span><span class="w"></span><span class="l">Type=simple</span><span class="w">
</span><span class="w"></span><span class="l">User=hal-server</span><span class="w">
</span><span class="w"></span><span class="l">Group=hal-server</span><span class="w">
</span><span class="w"></span><span class="l">ExecStart=</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="p">[</span><span class="l">Install]</span><span class="w">
</span><span class="w"></span><span class="l">WantedBy=multi-user.target</span><span class="w">
</span></code></pre></div><p>Vous pourrez le modifier à votre guise selon votre utilisation, vous devrez préciser le chemin de l&rsquo;exécutable via <code>ExecStart</code>. Dans le chemin vous devrez exécuter le fichier <code>server</code> dans le zip fournis dans la release. Vous préciserez le chemin de la ou vous avez placé le dossier.</p>
<p>Nous vous recommandons de mettre le dossier dans un dossier inaccessible par les utilisateurs et de créer un utilisateur particulier, ici <code>hal-server</code>.</p>
<p>Pour lancer le serveur sous linux la commande est <code>./server</code>.</p>
<h2 id="installation-manuelle-windows">Installation Manuelle Windows<a href="#installation-manuelle-windows" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Pour l&rsquo;installation manuelle windows, même chose à l&rsquo;exception que pour le moment nous n&rsquo;avons pas fournis de service Windows (.ini) pour un lancement automatique du service. Vous pouvez cependant le créer pour vous dans la même architecture que le init.d fournis précédemment.</p>
<p>Un dossier .zip est fournis dans l&rsquo;onglet release du Github, dedans vous trouverez un exécutable pour windows et vous pourrez le lancer de la même manière que précédemment ou bien en double cliquant dessus simplement.</p>
<h1 id="client-installation">Client Installation<a href="#client-installation" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<p>La seule façon existante d&rsquo;installer le client et de l&rsquo;installer manuellement.</p>
<h2 id="installation-manuelle-linux-1">Installation Manuelle Linux<a href="#installation-manuelle-linux-1" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Comme pour le serveur, un daemon init.d est disponible:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="p">[</span><span class="l">Unit]</span><span class="w">
</span><span class="w"></span><span class="l">Description=HAL client daemon</span><span class="w">
</span><span class="w"></span><span class="l">After=network-online.target</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="p">[</span><span class="l">Service]</span><span class="w">
</span><span class="w"></span><span class="l">Type=simple</span><span class="w">
</span><span class="w"></span><span class="l">User=hal-client</span><span class="w">
</span><span class="w"></span><span class="l">Group=hal-client</span><span class="w">
</span><span class="w"></span><span class="l">ExecStart=</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="p">[</span><span class="l">Install]</span><span class="w">
</span><span class="w"></span><span class="l">WantedBy=multi-user.target</span><span class="w">
</span></code></pre></div><p>Vous pouvez le modifier à votre guise, vous devrez spécifié le chemin d&rsquo;installation que vous aurez choisis pour le client. Vous devrez exécuté l&rsquo;exécutable <code>client</code> présent dans le zip fournis dans l&rsquo;onglet release du Github.</p>
<p>Nous vous recommandons de mettre le dossier dans un dossier inaccessible par les utilisateurs et de créer un utilisateur particulier, ici <code>hal-client</code>.</p>
<p>Pour lancer le client sous linux la commande est <code>./client</code>.</p>
<h2 id="installation-manuelle-windows-1">Installation Manuelle Windows<a href="#installation-manuelle-windows-1" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Pour l&rsquo;installation manuelle windows, même chose à l&rsquo;exception que pour le moment nous n&rsquo;avons pas fournis de service Windows (.ini) pour un lancement automatique du service. Vous pouvez cependant le créer pour vous dans la même architecture que le init.d fournis précédemment.</p>
<p>Un dossier .zip est fournis dans l&rsquo;onglet release du Github, dedans vous trouverez un exécutable pour windows et vous pourrez le lancer de la même manière que précédemment ou bien en double cliquant dessus simplement.</p>
<h2 id="configuration">Configuration<a href="#configuration" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<h3 id="comprendre-configjson-et-config_localjson">Comprendre <code>config.json</code> et <code>config_local.json</code><a href="#comprendre-configjson-et-config_localjson" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>2 types de fichiers de configurations sont présents:</p>
<ul>
<li>config_local.json</li>
<li>config_global.json</li>
</ul>
<p><code>config_local.json</code>: sert uniquement à rajouter des configurations de plugin. Il est déposé en local dans le dossier &ldquo;config&rdquo; sur les <em>clients</em>, et ne sera en aucun cas supprimé ou modifié par le serveur.</p>
<p><code>config.json</code>: sert à modifier tout ce qui est possible dans HAL. Tout est détaillé plus bas dans la documentation. Ce fichier sera distribué à tous les clients et par la suite mis à jour via le serveur.</p>
<p>Il sera impératif de rédiger son propre <code>config.json</code>, et de l&rsquo;ajouter dans le dossier &ldquo;plugins&rdquo; du serveur.</p>
<h3 id="configurer-le-serveur-pour-le-client">Configurer le serveur pour le client<a href="#configurer-le-serveur-pour-le-client" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<h4 id="changement-dip-et-de-port">Changement d&rsquo;ip et de port<a href="#changement-dip-et-de-port" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>Pour régler la connexion au serveur d&rsquo;un client, il faut ajouter dans le fichier <code>config_local.json</code>, présent sur les clients :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
	<span class="nt">&#34;server&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="nt">&#34;ip&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;ip du serveur&gt;&#34;</span><span class="p">,</span>
		<span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="err">&lt;port</span> <span class="err">du</span> <span class="err">serveur&gt;</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><ul>
<li><code>ip</code>: l&rsquo;ip d&rsquo;un des serveurs HAL</li>
<li><code>port</code>: port d&rsquo;un des serveurs HAL, par défaut <code>11000</code></li>
</ul>
<p><strong>Exemple d&rsquo;un <code>config.json</code> (&lt;dossier du serveur&gt;/plugins/config.json)</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;storage&#34;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&#34;server&#34;</span>
  <span class="p">],</span>

  <span class="nt">&#34;plugins&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;upgrades_available.sh&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;activated&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
      <span class="nt">&#34;os&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&#34;linux&#34;</span>
      <span class="p">],</span>
      <span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="mf">0.010</span>
    <span class="p">},</span>
    <span class="nt">&#34;kernel_version.py&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;activated&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
      <span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="mf">0.010</span><span class="p">,</span>
      <span class="nt">&#34;differencial_all&#34;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nt">&#34;connected_user.py&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;activated&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
      <span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="mf">0.010</span><span class="p">,</span>
      <span class="nt">&#34;differencial&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&#34;connected_user&#34;</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><strong>Exemple d&rsquo;un <code>config_local.json</code> (&lt;dossier du client&gt;/config/config_local.json)</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;server&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;ip&#34;</span><span class="p">:</span> <span class="s2">&#34;XX.XX.XX.XX&#34;</span><span class="p">,</span>
    <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">11000</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="configurer-le-serveur">Configurer le serveur<a href="#configurer-le-serveur" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>La configuration du serveur se fait dans le fichier <code>config.json</code> présent dans la racine du serveur</p>
<table>
<thead>
<tr>
<th>Nom</th>
<th style="text-align:center">Optionnel</th>
<th style="text-align:center">Type</th>
<th>Signification</th>
</tr>
</thead>
<tbody>
<tr>
<td>ip</td>
<td style="text-align:center"></td>
<td style="text-align:center">string</td>
<td>l&rsquo;ip sur lequel le serveur tourne</td>
</tr>
<tr>
<td>port</td>
<td style="text-align:center"></td>
<td style="text-align:center">uint</td>
<td>le porte sur lequel le serveur tourne (à eviter de modifier)</td>
</tr>
<tr>
<td>max_threads</td>
<td style="text-align:center"></td>
<td style="text-align:center">uint</td>
<td>le nombre maximum de threads que le serveur peut utiliser. Plus de threads équivaut à plus de traitement rapidement. Pour de 0 - 200 clients nous recommandons 2, pour 200 - 3000: 4, 3000 - 6000: 8, +6000: 8-16</td>
</tr>
<tr>
<td>update_rate</td>
<td style="text-align:center"></td>
<td style="text-align:center">uint</td>
<td>période en milliseconde à laquelle le serveur va scanner son dossier plugin pour envoyer les modifications aux clients</td>
</tr>
<tr>
<td>save_path</td>
<td style="text-align:center"></td>
<td style="text-align:center">string</td>
<td>chemin pour lequel sera sauvegardé les résultats des plugins si le paramètre &ldquo;server&rdquo; est indiqué dans les clients</td>
</tr>
</tbody>
</table>
<p>Exemple d&rsquo;un fichier <code>config.json</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;ip&#34;</span><span class="p">:</span> <span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span>
  <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">11000</span><span class="p">,</span>
  <span class="nt">&#34;max_threads&#34;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
  <span class="nt">&#34;update_rate&#34;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="nt">&#34;save_path&#34;</span><span class="p">:</span> <span class="s2">&#34;/tmp/hal_save&#34;</span>
<span class="p">}</span>
</code></pre></div><h3 id="configurer-le-client">Configurer le client<a href="#configurer-le-client" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>La configuration du client peut se faire dans le fichier <code>config.json</code>, présent dans le dossier &ldquo;plugins&rdquo; du serveur, ce qui permettra de facilement ajouter, supprimer, modifier la configuration de tous les clients sans problème.</p>
<p>Si besoin, un client peut avoir d&rsquo;autres plugins en plus, pour cela, il faut les ajouter dans <code>config_local.json</code>.</p>
<h4 id="attributs">Attributs<a href="#attributs" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<table>
<thead>
<tr>
<th>Nom</th>
<th style="text-align:center">Optionnel</th>
<th style="text-align:center">Type</th>
<th>Signification</th>
</tr>
</thead>
<tbody>
<tr>
<td>activated</td>
<td style="text-align:center"></td>
<td style="text-align:center">bool</td>
<td>le plugin est activé si <code>&quot;true&quot;</code>, desactivé si <code>&quot;false&quot;</code></td>
</tr>
<tr>
<td>heartbeat</td>
<td style="text-align:center"></td>
<td style="text-align:center">uint</td>
<td>fréquence d&rsquo;éxecution du plugin, 1 heartbeat = 1 execution par minute, 2 = 2 par minute &hellip;</td>
</tr>
<tr>
<td>os</td>
<td style="text-align:center">X</td>
<td style="text-align:center">string[]</td>
<td>sur quel système d&rsquo;exploitation sera executé le plugin. Valeurs possible: <code>&quot;linux&quot;</code>, <code>&quot;windows&quot;</code>, <code>&quot;linux&quot;,&quot;windows&quot;</code>. Si non spécifié, le plugin sera executé sur tout les OS.</td>
</tr>
<tr>
<td>admin_rights</td>
<td style="text-align:center">X</td>
<td style="text-align:center">bool</td>
<td>execute le plugin en mode administrateur si <code>&quot;true&quot;</code>, mode utilisateur si <code>&quot;false&quot;</code></td>
</tr>
<tr>
<td>admin_username</td>
<td style="text-align:center">X</td>
<td style="text-align:center">string</td>
<td>si admin_rights est activé, lance le plugin en mode administrateur avec l&rsquo;utilisateur spécifié</td>
</tr>
<tr>
<td>differencial_all</td>
<td style="text-align:center">X</td>
<td style="text-align:center">bool</td>
<td>vérifie si le résultat json du plugin est différent de l&rsquo;ancien pour TOUT ses attributs. Si tout les résultats des attributs sont identiques, alors le retour est ignoré</td>
</tr>
<tr>
<td>differencial</td>
<td style="text-align:center">X</td>
<td style="text-align:center">string[]</td>
<td>vérifie si le résultat json du plugin est différent de l&rsquo;ancien pour les attributs . Si tout les résultats des attributs explicités sont identiques, alors le retour est ignoré</td>
</tr>
</tbody>
</table>
<p><strong>Exemple (config local/serveur)</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;plugins&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;upgrades_available.sh&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;activated&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
      <span class="nt">&#34;os&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&#34;linux&#34;</span>
      <span class="p">],</span>
      <span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="mf">0.010</span>
    <span class="p">},</span>
    <span class="nt">&#34;kernel_version.py&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;activated&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
      <span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="mf">0.010</span><span class="p">,</span>
      <span class="nt">&#34;differencial_all&#34;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nt">&#34;connected_user.py&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;activated&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
      <span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="mf">0.010</span><span class="p">,</span>
      <span class="nt">&#34;differencial&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&#34;connected_user&#34;</span>
      <span class="p">]</span>
    <span class="p">},</span>
	<span class="nt">&#34;do_upgrades.sh&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;activated&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
      <span class="nt">&#34;os&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&#34;linux&#34;</span>
      <span class="p">],</span>
      <span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
	  <span class="nt">&#34;admin_rights&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
	  <span class="nt">&#34;admin_username&#34;</span><span class="p">:</span> <span class="s2">&#34;usr_do_upgrades&#34;</span>
	<span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h4 id="mode-administrateur">Mode administrateur<a href="#mode-administrateur" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>Le mode administrateur fonctionne sur Windows et Linux. Il permet d&rsquo;éxecuter un plugin avec les droits supplémentaires offerts par le système d&rsquo;exploitation.
Un utilisateur doit être assigné, car l&rsquo;execution d&rsquo;un plugin en mode administrateur doit se faire sans mot de passe, pour des raisons de sécurité.</p>
<p>Il faut être très vigileant en utilisant le mode administrateur, car les plugins font exactement ce qu&rsquo;on leur demande de faire, et une erreur peut être vite arrivé.</p>
<p>Nous conseillons de l&rsquo;utiliser en dernier recours et de bien avoir fait les tests nécessaires avant de le mettre en production.</p>
<h4 id="mode-differencial">Mode differencial<a href="#mode-differencial" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>Le mode differencial permet d&rsquo;économiser de l&rsquo;espace disque et de l&rsquo;utilisation réseau.</p>
<p>En effet, pour un plugin, il se peut que son retour soit très souvent le même. Pour éviter, si besoin, de stocker les répétitions, le mode differencial existe.</p>
<p>Prenons l&rsquo;exemple d&rsquo;un plugin qui va renvoyer:</p>
<ul>
<li>l&rsquo;utilisateur connecté</li>
<li>l&rsquo;heure à laquelle le plugin est executé</li>
<li>le système d&rsquo;exploitation</li>
</ul>
<p>Toutes les 5 minutes.</p>
<p>Exemple d&rsquo;un retour:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
	<span class="nt">&#34;user&#34;</span><span class="p">:</span> <span class="s2">&#34;XXX&#34;</span><span class="p">,</span>
	<span class="nt">&#34;date&#34;</span><span class="p">:</span> <span class="s2">&#34;2020-05-28T14:00:00.000Z&#34;</span><span class="p">,</span>
	<span class="nt">&#34;os&#34;</span><span class="p">:</span> <span class="s2">&#34;debian&#34;</span>
<span class="p">}</span>
</code></pre></div><p>Il est alors interessant de n&rsquo;avoir l&rsquo;information qu&rsquo;uniquement quand un nouvel utilisateur est connecté sur la machine.</p>
<p>Dans les attributs du plugin, il faut alors ajouter le mode differencial sur l&rsquo;attribut &ldquo;user&rdquo; et &ldquo;os&rdquo;.</p>
<p>Exemple (config local/serveur):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
	<span class="err">...</span>
	<span class="nt">&#34;plugins&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="err">...</span>
		<span class="nt">&#34;user_info.sh&#34;</span><span class="p">:</span> <span class="p">{</span>
			<span class="nt">&#34;activated&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
			<span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
			<span class="nt">&#34;differencial&#34;</span><span class="p">:</span> <span class="p">[</span>
				<span class="s2">&#34;user&#34;</span><span class="p">,</span>
				<span class="s2">&#34;os&#34;</span>
			<span class="p">]</span>
		<span class="p">}</span>
		<span class="err">...</span>
	<span class="p">}</span>
	<span class="err">...</span>
<span class="p">}</span>
</code></pre></div><p>Si, et uniquement si le résultat des attributs &ldquo;user&rdquo; OU &ldquo;os&rdquo; sont différents, alors le retour sera sauvegardé.</p>
<p>Maintenant, prenons l&rsquo;exemple d&rsquo;un plugin qui va renvoyer la liste auto-générée complète des packages installés sur la machine avec leur version.</p>
<p>Exemple d&rsquo;un retour:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
	<span class="nt">&#34;package1&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.0&#34;</span><span class="p">,</span>
		<span class="nt">&#34;updated&#34;</span><span class="p">:</span> <span class="s2">&#34;2020-02-20T14:00:00.000Z&#34;</span>
	<span class="p">},</span>
	<span class="nt">&#34;package2&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.1&#34;</span><span class="p">,</span>
		<span class="nt">&#34;updated&#34;</span><span class="p">:</span> <span class="s2">&#34;2020-01-1T12:00:00.000Z&#34;</span>
	<span class="p">},</span>
	<span class="nt">&#34;package3&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;4.0.0&#34;</span><span class="p">,</span>
		<span class="nt">&#34;updated&#34;</span><span class="p">:</span> <span class="s2">&#34;2019-03-02T17:00:00.000Z&#34;</span>
	<span class="p">},</span>
	<span class="err">...</span>
	<span class="nt">&#34;package300&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.2.0&#34;</span><span class="p">,</span>
		<span class="nt">&#34;updated&#34;</span><span class="p">:</span> <span class="s2">&#34;2018-10-10T18:00:00.000Z&#34;</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Le mode differencial ne suffirait pas, car les entrées sont trop différentes et inconnus d&rsquo;avance.
Il faudra alors utiliser le mode &ldquo;differencial_all&rdquo; qui lui va regarder TOUT les attributs, si le résultat du nouveau est différent du résultat de l&rsquo;ancien, alors le retour sera sauvegardé.</p>
<p>Exemple (config local/serveur):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
	<span class="err">...</span>
	<span class="nt">&#34;plugins&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="err">...</span>
		<span class="nt">&#34;packages_list.sh&#34;</span><span class="p">:</span> <span class="p">{</span>
			<span class="nt">&#34;activated&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
			<span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
			<span class="nt">&#34;differencial_all&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span>
		<span class="p">}</span>
		<span class="err">...</span>
	<span class="p">}</span>
	<span class="err">...</span>
<span class="p">}</span>
</code></pre></div><h2 id="configuration-des-clients-par-le-serveur">Configuration des clients par le serveur<a href="#configuration-des-clients-par-le-serveur" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Le serveur envois automatiquement les ajouts de plugins et les modifications faites à son fichier <code>plugins/config.json</code> à tous les clients.
Cela permet donc de configurer les clients automatiquement.</p>
<p>Pour ajouter un plugin, il suffit de déposer le plugin dans le dossier <code>plugins</code> du client et d&rsquo;ensuite modifier <code>plugins/config.json</code> en ajoutant l&rsquo;entrée du plugin.
Exemple:</p>
<pre tabindex="0"><code>Dossier serveur
	|
	|-&gt; plugins
			|--- config.json
			|--- plugin1.sh
			|--- plugin2.rb
			|--- plugin3.py &lt;----- on dépose ce plugin


</code></pre><p>Il faut ensuite ajouter l&rsquo;entrée &ldquo;plugin3.py&rdquo; dans le fichier <code>config.json</code>, puis sauvegarder.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;storage&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&#34;server&#34;</span>
    <span class="p">],</span>

    <span class="nt">&#34;plugins&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;plguin1.sh&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;os&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&#34;linux&#34;</span>
            <span class="p">],</span>
            <span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&#34;differencial_all&#34;</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">},</span>
        <span class="nt">&#34;plugin2.rb&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;activated&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
            <span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&#34;differencial_all&#34;</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">},</span>
        <span class="nt">&#34;plugin3.py&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;activated&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
            <span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&#34;differencial_all&#34;</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div><p>Une fois ces modifications de faites, les clients vont venir récupérer les changements et se mettre à jour automatiquement.</p>
<p><strong>/!\ Vous ne pouvez pas suppirmer de plugin en passant par le serveur. Si vous devez en supprimer, il faut alors soit mettre &ldquo;activated&rdquo; à false, soit les supprimer directement sur les clients.</strong></p>
<h2 id="rédaction-plugins">Rédaction plugins<a href="#rédaction-plugins" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Les informations retournées par le plugin doivent être sous un format JSON.
Pour une efficacité optimal, il convient de normaliser les sorties de vos plugins. C&rsquo;est à dire, respecté une convention de nommage définit selon vos principes.</p>
<p>Chaque plugin doit être mit dans le dossier &ldquo;plugins&rdquo; du serveur, qui se chargera de les transmettres aux clients. De plus, une entrée doit être écrite dans le fichier config.json pour avoir les informations nécéssaire au bon déroulement du plugin.</p>
<p><em><strong><a href="#vialangagenonsupport%C3%A9pard%C3%A9faut-et-scripts-windows">Si utilisation de langage de scripts sous Windows</a></strong></em></p>
<h3 id="difference-entre-assemblydll-dll-classique-shared-object-et-script">Difference entre AssemblyDLL, DLL classique, shared object et script<a href="#difference-entre-assemblydll-dll-classique-shared-object-et-script" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Le manageur de plugins de HAL permet de lire différents types de DLL pour les plugins, ce qui en fait un outil extrémement modulable.</p>
<ul>
<li>Les AssemblyDLL sont les dll générées par la création de bibliothèques .NET, pour Windows et Linux</li>
<li>Les DLL &ldquo;classiques&rdquo; sont celles générées par des compilateurs types C, C++&hellip;, mais uniquement pour Windows.</li>
<li>Les Shared Objects sont comme les DLL classiques, mais uniquement sous Linux.</li>
<li>Les scripts peuvent être codé en n&rsquo;importe quel langage de script (Lua, PHP, Bash, Python, Ruby&hellip;). Un fichier source unique doit être fournit par plugin. D&rsquo;autre interpreteurs peuvent être rajoutés si ceux par défaut ne correspondent pas aux attentes.</li>
</ul>
<p>Ces différents format de plugins peuvent être combinés à souhait poour avoir une liste de plugins aussi personalisable que possible.</p>
<h3 id="rédaction-de-plugins-via-langages-supportés-par-défaut">Rédaction de plugins via langages supportés par défaut<a href="#rédaction-de-plugins-via-langages-supportés-par-défaut" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<h4 id="exemple-en-cc-dll-classique-shared-object">Exemple en C/C++ (DLL classique, Shared Object)<a href="#exemple-en-cc-dll-classique-shared-object" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>Un point d&rsquo;entrée est obligatoire pour l&rsquo;execution du plugin en DLL classique et SO. Le retour de ce point d&rsquo;entrée sera alors sauvegardé par le client. Il doit impérativement être en JSON.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">char</span><span class="o">*</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre></div><p>Exemple d&rsquo;un code en C (ip_infos.c) uniquement disponible sur linux (ifaddrs.h) permettant de récupérer le nom de la carte réseau, son addresse et les données.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;ifaddrs.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">char</span> <span class="o">*</span><span class="nf">run</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ifaddrs</span><span class="o">*</span> <span class="n">id</span><span class="p">;</span>
	<span class="kt">char</span><span class="o">*</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">1024</span><span class="p">);</span>

	<span class="n">getifaddrs</span><span class="p">(</span><span class="o">&amp;</span><span class="n">id</span><span class="p">);</span>

	<span class="n">sprintf</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="s">&#34;{ </span><span class="se">\&#34;</span><span class="s">name</span><span class="se">\&#34;</span><span class="s">: </span><span class="se">\&#34;</span><span class="s">%s</span><span class="se">\&#34;</span><span class="s">, </span><span class="se">\&#34;</span><span class="s">addr</span><span class="se">\&#34;</span><span class="s">: %d, </span><span class="se">\&#34;</span><span class="s">data</span><span class="se">\&#34;</span><span class="s">: %d}&#34;</span><span class="p">,</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">ifa_name</span><span class="p">,</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">ifa_addr</span><span class="p">,</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">ifa_data</span><span class="p">);</span>
	
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p><strong>Il faut impérativement que la variable de retour soit allouée en mémoire (via malloc, calloc&hellip;)</strong>
Des fonctions peuvent bien sûr être faites pour clarifier le code.</p>
<p>Compilation en .so sous linux:
<code>gcc -Wall -Wextra -fPIC -shared ip_infos.c -o ip_infos.so</code></p>
<p>Compilation en .dll sous windows (si plugin compatible) avec utilisation de <a href="http://www.mingw.org/">MinGW</a>
<code>gcc -Wall -Wextra -fPIC -shared fichier.c -o ip_infos.dll</code></p>
<p>puis copier ip_infos.so dans le dossier plugins et rajouter une entrée dans config.json:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"> <span class="err">...</span>
	<span class="s2">&#34;plugins&#34;</span><span class="err">:</span> <span class="p">{</span>
	    <span class="err">...</span>
		<span class="nt">&#34;ip_infos.dll&#34;</span><span class="p">:</span> <span class="p">{</span>
			<span class="nt">&#34;activated&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
			<span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
			<span class="nt">&#34;os&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;linux&#34;</span><span class="p">]</span>
		<span class="p">},</span>
	    <span class="nt">&#34;ip_infos.so&#34;</span><span class="p">:</span> <span class="p">{</span>
			<span class="nt">&#34;activated&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
			<span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
			<span class="nt">&#34;os&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;windows&#34;</span><span class="p">]</span>
		<span class="p">}</span>
		<span class="err">...</span>
	<span class="p">}</span>
 <span class="err">...</span>
</code></pre></div><h4 id="exemple-en-c-assemblydll">Exemple en C# (AssemblyDLL)<a href="#exemple-en-c-assemblydll" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>Un point d&rsquo;entrée est aussi obligatoire pour l&rsquo;execution du plugin. Le retour du point d&rsquo;entrée sera alors sauvegardé par le client. Il doit impérativement être en JSON.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="k">namespace</span> <span class="nn">Plugin</span> 
<span class="p">{</span>
	<span class="k">public</span> <span class="k">class</span> <span class="nc">NomPlugin</span> 
	<span class="p">{</span>
	    <span class="k">public</span> <span class="kt">string</span> <span class="n">Run</span><span class="p">()</span> 
	    <span class="p">{</span>

	    <span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Création d&rsquo;un projet dotnet:</p>
<p><code>dotnet new classlib -n plugin</code></p>
<p>Modifier Class1.cs pour écrire son plugin
Exemple d&rsquo;un plugin pour récupérer le nom de la machine:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">plugin</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MachineName</span> 
    <span class="p">{</span>
	    <span class="k">public</span> <span class="kt">string</span> <span class="n">Run</span><span class="p">()</span> 
	    <span class="p">{</span>
		    <span class="k">return</span> <span class="s">$&#34;{{\&#34;</span><span class="n">machinename</span><span class="err">\</span><span class="s">&#34;: {Environment.MachineName}}}&#34;</span><span class="p">;</span>
	    <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Puis build la librairie:</p>
<p><code>dotnet build</code></p>
<p>Finalement, copier et renommer si besoin plugin.dll et le mettre ensuite dans le dossier plugins et ajouter une entrée dans config.json:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"> <span class="err">...</span>
	<span class="s2">&#34;plugins&#34;</span><span class="err">:</span> <span class="p">{</span>
	    <span class="err">...</span>
		<span class="nt">&#34;plugin.dll&#34;</span><span class="p">:</span> <span class="p">{</span>
			<span class="nt">&#34;activated&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
			<span class="nt">&#34;heartbeat&#34;</span><span class="p">:</span> <span class="s2">&#34;0.5&#34;</span>
		<span class="p">}</span>
		<span class="err">...</span>
	<span class="p">}</span>
 <span class="err">...</span>
</code></pre></div><h4 id="exemple-en-go-script--dll-classique">Exemple en GO (Script / DLL classique)<a href="#exemple-en-go-script--dll-classique" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>Go est intéprété en tant que langage de script dans HAL. De ce fait, il doit respecter les contraintes des autres langages de script, c&rsquo;est à dire defaire sortir le JSON sur la sortie standard.</p>
<p>Exemple d&rsquo;un plugin</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;fmt&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="s">&#34;{\&#34;test\&#34;: \&#34;reussi\&#34;}&#34;</span><span class="p">)</span>
<span class="p">}</span>

</code></pre></div><p>Il est aussi possible de faire du Go compilé (sous forme de DLL). L&rsquo;avantage étant que le client n&rsquo;est pas obligé de posseder golang.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;C&#34;</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>

<span class="c1">//export run
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">run</span><span class="p">()</span> <span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">char</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">C</span><span class="p">.</span><span class="nf">CString</span><span class="p">(</span><span class="s">&#34;{\&#34;test\&#34;: \&#34;reussi\&#34;}&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>Il est imépratif d&rsquo;avoir le commentaire &ldquo;export run&rdquo; pour que cela fonctionne. De plus, il faut aussi obligatoirement mettre *C.char comme type de retour.</p>
<p>Compilation: <code>go build -o testplugin.dll -buildmode=c-shared</code></p>
<h4 id="exemple-en-python-script">Exemple en Python (Script)<a href="#exemple-en-python-script" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<ul>
<li>
<p>Créer un fichier <code>osinfo.py</code></p>
</li>
<li>
<p>Y ajouter:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">osInfo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&#34;machine&#34;</span><span class="p">:</span><span class="n">platform</span><span class="o">.</span><span class="n">machine</span><span class="p">(),</span>
    <span class="s2">&#34;version&#34;</span><span class="p">:</span><span class="n">platform</span><span class="o">.</span><span class="n">version</span><span class="p">(),</span>
    <span class="s2">&#34;platform&#34;</span><span class="p">:</span><span class="n">platform</span><span class="o">.</span><span class="n">platform</span><span class="p">(),</span>
    <span class="s2">&#34;system&#34;</span><span class="p">:</span><span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">(),</span>
    <span class="s2">&#34;processor&#34;</span><span class="p">:</span><span class="n">platform</span><span class="o">.</span><span class="n">processor</span><span class="p">()</span>
<span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">osInfo</span><span class="p">))</span>
</code></pre></div></li>
<li>
<p>Déplacer le fichier dans le répertoire &ldquo;plugins&rdquo; du serveur</p>
</li>
</ul>
<h3 id="via-langage-non-supporté-par-défaut-et-scripts-windows">Via langage non supporté par défaut (ET scripts Windows)<a href="#via-langage-non-supporté-par-défaut-et-scripts-windows" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<h4 id="ajout-dun-interpreteur-via-fichier-de-configuration">Ajout d&rsquo;un interpreteur via fichier de configuration<a href="#ajout-dun-interpreteur-via-fichier-de-configuration" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p><em><strong>Il faut impérativement configurer le chemin des intérpreteurs sur Windows</strong></em></p>
<p>Un langage n&rsquo;est peut être pas supporté par défaut, ou bien l&rsquo;interpreteur par défaut d&rsquo;un certain langage ne vous convients pas, il faudra alors pour cela en ajouter un nouveau pour pouvoir executer le plugin.</p>
<p>Il faudra alors modifier le fichier <code>server/plugins/config.json</code> pour y ajouter des attributs JSON.</p>
<p>L&rsquo;attribut <code>interpreter</code> possède une liste de système d&rsquo;exploitation (<code>windows</code> et <code>linux</code>)</p>
<p>Liste des clé d&rsquo;intepréteur par défaut:</p>
<ul>
<li>python</li>
<li>ruby</li>
<li>powershell</li>
<li>bash</li>
</ul>
<p>Exemple:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
	<span class="nt">&#34;interpreter&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="nt">&#34;windows&#34;</span><span class="p">:</span> <span class="p">{</span>
			<span class="nt">&#34;python&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;chemin vers python&gt;\python.exe&#34;</span>
		<span class="p">},</span>
		<span class="nt">&#34;linux&#34;</span><span class="p">:</span> <span class="p">{</span>
			<span class="nt">&#34;python&#34;</span><span class="p">:</span> <span class="s2">&#34;/usr/bin/python3&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>

	<span class="nt">&#34;plugins&#34;</span><span class="p">:</span> <span class="p">{</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h4 id="ajout-dune-extension-de-plugin-personnalisée">Ajout d&rsquo;une extension de plugin personnalisée<a href="#ajout-dune-extension-de-plugin-personnalisée" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>Pour ajouter une extension personnalisée, il suffit d&rsquo;ajouter l&rsquo;attribut <code>custom_extensions</code> dans le fichier de configuration.</p>
<p>Il faut impérativement que la clé soit l&rsquo;extension du fichier, et la valeur le nom de l&rsquo;intérpreteur, qui sera utilisé par l&rsquo;attribut <code>interpreter</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;custom_extensions&#34;</span><span class="p">:</span> <span class="p">{</span>
  	<span class="nt">&#34;.php&#34;</span><span class="p">:</span> <span class="s2">&#34;php&#34;</span><span class="p">,</span>
	<span class="nt">&#34;.lua&#34;</span><span class="p">:</span> <span class="s2">&#34;lua&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;interpreter&#34;</span><span class="p">:</span> <span class="p">{</span>
	<span class="nt">&#34;linux&#34;</span><span class="p">:</span> <span class="p">{</span>
	  <span class="nt">&#34;php&#34;</span><span class="p">:</span> <span class="s2">&#34;path/to/php&#34;</span><span class="p">,</span>
	  <span class="nt">&#34;lua&#34;</span><span class="p">:</span> <span class="s2">&#34;path/to/lua&#34;</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="err">...</span>
  <span class="p">},</span>

  <span class="nt">&#34;plugins&#34;</span><span class="p">:</span> <span class="p">{</span>
	<span class="nt">&#34;my_plugin.php&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="err">...</span>
	<span class="p">},</span>
	<span class="nt">&#34;my_plugin.lua&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="err">...</span>
	<span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Ne surtout pas oublier de rajouter un intépréteur, car aucun n&rsquo;a été défini par défaut, que ce soit via config.json ou les variables d&rsquo;environnements.</p>
<h4 id="ajout-din-interpreteur-via-variables-denvironnements">Ajout d&rsquo;in interpreteur via variables d&rsquo;environnements<a href="#ajout-din-interpreteur-via-variables-denvironnements" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>Il existe aussi la possibilité de configurer une variable d&rsquo;environnement (en fonction de votre OS), contenant alors le chemin vers l&rsquo;intepréteur. Il n&rsquo;est donc pas obligé de modifier le fichier de configuration avec cette méthode.
La variable d&rsquo;environnement doit avoir comme clé le nom en majuscule (ex: PYTHON, RUBY, POWERSHELL&hellip;) et comme valeur le chemin vers l&rsquo;intepréteur</p>
<p>Exemple sous Linux:</p>
<pre tabindex="0"><code>PYTHON=/usr/bin/python3
RUBY=/usr/bin/ruby
BASH=/usr/bin/bash
</code></pre><p>Pour linux, des intepréteurs par défaut sont déjà configurés, il n&rsquo;est pas alors obligé de les spécifier pour les types de scripts supportés, bien que cela soit très recommandés.</p>
<h2 id="vérification-des-sorties-des-plugins">Vérification des sorties des plugins<a href="#vérification-des-sorties-des-plugins" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<h3 id="présentation-du-plugins_checker">Présentation du plugins_checker<a href="#présentation-du-plugins_checker" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Un outil a été crée dans le but de vérifier si une collection de plugins renvoient un json valide.
Pour ça, il faut se rendre dans &ldquo;plugins_checker&rdquo; et modifier le fichier &ldquo;config.json&rdquo; pour mettre un ou plusieurs chemins de là où se trouve les plugins et le fichier de configuration de ces derniers.
Il faut impérativement suivre ce schéma:</p>
<ul>
<li>dossier
<ul>
<li>config.json</li>
<li>plugins
<ul>
<li>nomplugin1&hellip;</li>
<li>nomplugin2&hellip;</li>
<li>nomplugin3&hellip;
&hellip;</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Le fichier <code>config.json</code> est un fichier de configuration normal. Il faut bien mettre <code>activated</code> à <code>true</code> pour que le plugin soit correctement executé.</p>
<p>Example:
Un dossier &ldquo;test1&rdquo; contient:</p>
<ul>
<li>config.json</li>
<li>plugins/
<ul>
<li>cpu_temperature.py</li>
<li>kernel_version.sh</li>
</ul>
</li>
</ul>
<p>et un autre dossier, test2, contient quand à lui:</p>
<ul>
<li>config.json</li>
<li>plugins/
<ul>
<li>connected_user.sh</li>
<li>os_informations.rb</li>
</ul>
</li>
</ul>
<p>Il faut alors tout simplement modifier le fichier &ldquo;config.json&rdquo; de plugins_checker comme suit:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;paths&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&#34;chemin/vers/test1&#34;</span><span class="p">,</span>
    <span class="s2">&#34;chemin/vers/test2&#34;</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div><p>Puis finalement executer le programme.
Démonstration avec les plugins dans client et client/examples:</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>L&rsquo;erreur: &ldquo;Error reading JToken from JsonReader. Path &lsquo;&rsquo;, line 0, position 0.&rdquo;
peut signifier plusieurs choses:</p>
<ul>
<li>un intépreteur par défaut n&rsquo;est pas installer, il faut vérifier si ruby, python3 et bash sont bien installés sur la machine</li>
<li>le retour n&rsquo;est pas du format json</li>
</ul>
<h2 id="configurer-les-sauvegardes-des-résultats">Configurer les sauvegardes des résultats<a href="#configurer-les-sauvegardes-des-résultats" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Le stockage sert a sauvegarder le résultat de chaque plugin pour pouvoir ensuite manipuler ces données.
Pour séléctionner le stockage voulu, il faut créer un attribut dans le fichier &ldquo;config.json&rdquo;:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
	<span class="nt">&#34;storage&#34;</span><span class="p">:</span> <span class="p">[</span>
	    <span class="s2">&#34;&lt;NOM_DU_STOCKAGE&gt;&#34;</span>
	 <span class="p">],</span>

	<span class="err">...</span>
	<span class="nt">&#34;plugins&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="err">...</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>NOM_DU_STOCKAGE peut être:</p>
<ul>
<li>&ldquo;text&rdquo; (sauvegarde sur la sortie console)</li>
<li>&ldquo;local&rdquo; (sauvegarde sur la machine client)</li>
<li>&ldquo;mangodb&rdquo; (sauvegarde sur une base mongodb)</li>
<li>&ldquo;influxdb&rdquo; (sauvegarde sur une base influxdb)</li>
<li>&ldquo;server&rdquo; (sauvegarde sur le serveur avec des dossiers et fichiers json sous format hiérarchique)</li>
</ul>
<p>Attention, si vous utilisez <code>mangodb</code>, <code>influxdb</code> ou tout autre base de donnée, il faut alors généralement spécifier une connection string:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
	<span class="nt">&#34;storage&#34;</span><span class="p">:</span> <span class="p">[</span>
	    <span class="s2">&#34;mangodb&#34;</span>
	<span class="p">],</span>
	<span class="nt">&#34;database&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="nt">&#34;connectionString&#34;</span><span class="p">:</span> <span class="p">[</span>
		    <span class="s2">&#34;mongodb://mongodb0.example.com:27017/admin&#34;</span>
		<span class="p">]</span>
	<span class="p">},</span>
	<span class="err">...</span>
<span class="p">}</span>
</code></pre></div><p>Il est possible de mettre autant de nom de stockage qui nécessaire. Pour lier les bonnes connectionString aux base de données, il faut alors les mettres dans l&rsquo;ordre, exemple:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
	<span class="nt">&#34;storage&#34;</span><span class="p">:</span> <span class="p">[</span>
	    <span class="s2">&#34;mongodb&#34;</span><span class="p">,</span>
	    <span class="s2">&#34;influxdb&#34;</span><span class="p">,</span>
	    <span class="s2">&#34;server&#34;</span><span class="p">,</span>
	    <span class="s2">&#34;mongodb&#34;</span><span class="p">,</span>
		<span class="s2">&#34;local&#34;</span>
	<span class="p">],</span>
	<span class="nt">&#34;database&#34;</span><span class="p">:</span> <span class="p">{</span>
		<span class="nt">&#34;connectionString&#34;</span><span class="p">:</span> <span class="p">[</span>
		    <span class="s2">&#34;mongodb://mongodb0.example.com:27017/admin&#34;</span><span class="p">,</span>
		    <span class="s2">&#34;http://influxdb.example.com:8086 &#34;</span><span class="p">,</span>
		    <span class="s2">&#34;mongodb://mongodb0.example.com:33333/admin&#34;</span>
		 <span class="p">]</span>
	<span class="p">},</span>
	<span class="err">...</span>
<span class="p">}</span>
</code></pre></div><p>Pour rajouter un stockage, il faut alors modifier le code source.</p>
<p>Il faut impérativement créer une classe héritant de IStoragePlugin, et par la suite créer ce dont vous avez besoin.
Ensuite, il faut modifier le fichier: client/factory/StorageFactory.cs pour y rajouter votre stockage personnalisé. Toutes les informations de comment procéder sont mit en commentaires dans ce fichier.</p>

		</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2021 <a href="https://rachartier.github.io/">Raphaël CHARTIER</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://rachartier.github.io/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>



	<script src="https://rachartier.github.io/js/bundle.min.7d8545daa55d62427355498dd8da13f98ff79a7938ce7d2a5e2ae1ec0de3beb8.js" integrity="sha256-fYVF2qVdYkJzVUmN2NoT+Y/3mnk4zn0qXirh7A3jvrg=" crossorigin="anonymous"></script>
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-212819313-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


</body>

</html>
